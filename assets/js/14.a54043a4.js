(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{360:function(e,t,r){"use strict";r.r(t);var a=r(43),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"springboot之微服务日志链路追踪"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#springboot之微服务日志链路追踪"}},[e._v("#")]),e._v(" SpringBoot之微服务日志链路追踪")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://search.maven.org/search?q=g:com.purgeteam%20AND%20a:log-trace-spring-boot-starter",target:"_blank",rel:"noopener noreferrer"}},[r("img",{attrs:{src:"https://img.shields.io/maven-central/v/com.purgeteam/log-trace-spring-boot-starter.svg?label=Maven%20Central",alt:"Maven Central"}}),r("OutboundLink")],1),e._v(" "),r("img",{attrs:{src:"https://img.shields.io/badge/SpringBoot-2.1.8.RELEASE-green.svg",alt:"License"}}),e._v(" "),r("img",{attrs:{src:"https://img.shields.io/badge/JAVA-1.8+-green.svg",alt:"License"}}),e._v(" "),r("img",{attrs:{src:"https://img.shields.io/badge/maven-3.0+-green.svg",alt:"License"}}),e._v(" "),r("a",{attrs:{href:"https://www.apache.org/licenses/LICENSE-2.0.html",target:"_blank",rel:"noopener noreferrer"}},[r("img",{attrs:{src:"https://img.shields.io/badge/license-Apache%202-4EB1BA.svg",alt:"License"}}),r("OutboundLink")],1)]),e._v(" "),r("h2",{attrs:{id:"简介"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[e._v("#")]),e._v(" 简介")]),e._v(" "),r("p",[e._v("在微服务里，业务出现问题或者程序出的任何问题，都少不了查看日志，一般我们使用 "),r("code",[e._v("ELK")]),e._v(" 相关的日志收集工具，服务多的情况下，业务问题也是有些难以排查，只能确定大致时间定位相关日志。"),r("code",[e._v("log-trace-spring-boot-starter")]),e._v(" 解决多个服务调用日志的问题，它可以将一个完整的调用链给整合为一个完整有序的日志。")]),e._v(" "),r("p",[e._v("支持组件：")]),e._v(" "),r("ul",[r("li",[e._v("zuul 调用")]),e._v(" "),r("li",[e._v("feign 调用")]),e._v(" "),r("li",[e._v("restTemplate 调用")]),e._v(" "),r("li",[e._v("dobbo 调用")])]),e._v(" "),r("p",[e._v("日志输出格式：")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("2019-11-14 14:22:07.796  INFO [log-trace-service-a-demo,ac8ffaaed5f343da,log-trace-zuul-demo,,] 88948 --- [nio-8081-exec-7] c.p.l.t.service.a.demo.TestController    : controller test2 执行 ac8ffaaed5f343da\n2019-11-14 14:23:15.569  INFO [log-trace-service-a-demo,04cf5392dc5c4881,log-trace-zuul-demo,,] 88948 --- [nio-8081-exec-9] c.p.l.t.service.a.demo.TestController    : controller test2 执行 04cf5392dc5c4881\n2019-11-14 14:24:44.183  INFO [log-trace-service-a-demo,86b5c555ce4f4451,log-trace-zuul-demo,,] 88948 --- [nio-8081-exec-1] c.p.l.t.service.a.demo.TestController    : controller test2 执行 86b5c555ce4f4451\n")])])]),r("p",[e._v("我们可以通过 "),r("code",[e._v("86b5c555ce4f4451")]),e._v(" id 进行查询链路上的所有日志信息。")]),e._v(" "),r("p",[r("code",[e._v("log-trace-service-a-demo")]),e._v(" 为当前应用。\n"),r("code",[e._v("log-trace-zuul-demo")]),e._v(" 为上游应用。")]),e._v(" "),r("p",[e._v("当然这些参数可以基于业务定制的。")]),e._v(" "),r("h2",{attrs:{id:"功能使用"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#功能使用"}},[e._v("#")]),e._v(" 功能使用")]),e._v(" "),r("h3",{attrs:{id:"添加依赖"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#添加依赖"}},[e._v("#")]),e._v(" 添加依赖")]),e._v(" "),r("p",[r("strong",[e._v("ps:")]),e._v(" 实际version版本请使用最新版\n"),r("strong",[e._v("最新版本:")]),e._v(" "),r("a",{attrs:{href:"https://search.maven.org/search?q=g:com.purgeteam%20AND%20a:log-trace-spring-boot-starter",target:"_blank",rel:"noopener noreferrer"}},[r("img",{attrs:{src:"https://img.shields.io/maven-central/v/com.purgeteam/log-trace-spring-boot-starter.svg?label=Maven%20Central",alt:"Maven Central"}}),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://search.maven.org/search?q=g:com.purgeteam%20AND%20a:log-trace-spring-boot-starter",target:"_blank",rel:"noopener noreferrer"}},[e._v("点击查看最新新版本"),r("OutboundLink")],1)]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("<dependency>\n  <groupId>com.purgeteam</groupId>\n  <artifactId>log-trace-spring-boot-starter</artifactId>\n  <version>0.1.2.RELEASE</version>\n</dependency>\n")])])]),r("p",[r("strong",[e._v("ps: 请基于 "),r("code",[e._v("SpirngBoot2.1.x")]),e._v(" 版本使用")])]),e._v(" "),r("h3",{attrs:{id:"配置应用"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#配置应用"}},[e._v("#")]),e._v(" 配置应用")]),e._v(" "),r("p",[e._v("这里以3个微服务来举例子。")]),e._v(" "),r("ol",[r("li",[r("code",[e._v("log-trace-zuul-demo")]),e._v(" 充当网关功能")]),e._v(" "),r("li",[r("code",[e._v("log-trace-service-a-demo")]),e._v(" 充当服务A")]),e._v(" "),r("li",[r("code",[e._v("log-trace-service-b-demo")]),e._v(" 充当服务B")])]),e._v(" "),r("p",[r("strong",[e._v("调用链路为:")])]),e._v(" "),r("p",[r("code",[e._v("log-trace-zuul-demo")]),e._v(" -> "),r("code",[e._v("log-trace-service-a-demo")]),e._v(" "),r("code",[e._v("TestController#test")]),e._v(" -> "),r("code",[e._v("log-trace-service-b-demo")]),e._v(" "),r("code",[e._v("TestController#test")])]),e._v(" "),r("p",[e._v("访问网关地址: "),r("code",[e._v("http://127.0.0.1:8000/a/test")])]),e._v(" "),r("p",[r("strong",[e._v("网关日志如下:")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("2019-11-14 14:27:37.434 DEBUG [33b07a9c5f324375,this] 89996 --- [nio-8000-exec-1] c.p.l.t.s.i.zuul.TracePreZuulFilter      : zuul traceid 33b07a9c5f324375\n")])])]),r("p",[e._v("网关转发至服务A")]),e._v(" "),r("p",[r("strong",[e._v("服务A 日志如下:")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("2019-11-14 14:27:37.476  INFO [log-trace-service-a-demo,33b07a9c5f324375,log-trace-zuul-demo,,] 88948 --- [nio-8081-exec-5] c.p.l.t.service.a.demo.TestController    : controller test2 执行 33b07a9c5f324375\n")])])]),r("p",[e._v("服务A 调用 服务B")]),e._v(" "),r("p",[r("strong",[e._v("服务B 日志如下:")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("2019-11-14 14:27:37.478  INFO [log-trace-service-b-demo,33b07a9c5f324375,log-trace-service-a-demo,,] 88952 --- [nio-8082-exec-3] c.p.l.t.servcie.b.demo.TestController    : header traceId 33b07a9c5f324375\n2019-11-14 14:27:37.478  INFO [log-trace-service-b-demo,33b07a9c5f324375,log-trace-service-a-demo,,] 88952 --- [nio-8082-exec-3] c.p.l.t.servcie.b.demo.TestController    : controller test 执行 33b07a9c5f324375\n2019-11-14 14:27:37.478  INFO [log-trace-service-b-demo,33b07a9c5f324375,log-trace-service-a-demo,,] 88952 --- [nio-8082-exec-3] c.p.l.trace.servcie.b.demo.TestService   : test 方法执行 33b07a9c5f324375\n2019-11-14 14:27:37.478  INFO [log-trace-service-b-demo,33b07a9c5f324375,log-trace-service-a-demo,,] 88952 --- [nio-8082-exec-3] c.p.l.trace.servcie.b.demo.TestService   : test1 方法执行 33b07a9c5f324375\n")])])]),r("p",[e._v("这样可以在第三方日志平台按照一个id进行查询了。")]),e._v(" "),r("p",[e._v("如 "),r("code",[e._v("ELK")]),e._v(" 通过 "),r("code",[e._v("33b07a9c5f324375")]),e._v(" id 查询出相关的所有链路调用。")]),e._v(" "),r("h3",{attrs:{id:"配置输出格式"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#配置输出格式"}},[e._v("#")]),e._v(" 配置输出格式")]),e._v(" "),r("p",[r("strong",[e._v("目前支持以上参数:")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("X-B3-ParentName 上游服务名称\nX-B3-TraceId 为一个请求分配的ID号，用来标识一条请求链路。\n")])])]),r("p",[r("strong",[e._v("通过 "),r("code",[e._v("application.properties")]),e._v(" 进行配置。")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("spring.trace.log.format=X-B3-TraceId,X-B3-ParentName\n\n\n`spring.trace.log.format` 配置参数顺序将影响日志输出格式。\n\n不配置将按照默认格式输出。\n")])])]),r("p",[e._v("日志输出如下:")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("2019-11-14 14:27:37.434 DEBUG [33b07a9c5f324375,this] 89996 --- [nio-8000-exec-1] c.p.l.t.s.i.zuul.TracePreZuulFilter      : zuul traceid 33b07a9c5f324375\n")])])]),r("h2",{attrs:{id:"总结"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),r("p",[e._v("目前实现了日志连贯的功能，后续将支持定制输出 比如按照登陆人员id进行输出，方便追踪用户行为。\n框架方便后续支持 "),r("code",[e._v("Dubbo")]),e._v(" 等。")]),e._v(" "),r("blockquote",[r("p",[e._v("示例代码地址:"),r("a",{attrs:{href:"https://github.com/purgeteam/log-trace-spring-boot",target:"_blank",rel:"noopener noreferrer"}},[e._v("log-trace-spring-boot"),r("OutboundLink")],1)])]),e._v(" "),r("blockquote",[r("p",[e._v("作者GitHub:\n"),r("a",{attrs:{href:"https://github.com/purgeyao",target:"_blank",rel:"noopener noreferrer"}},[e._v("Purgeyao"),r("OutboundLink")],1),e._v(" 欢迎关注")])]),e._v(" "),r("blockquote",[r("p",[e._v("qq交流群: "),r("code",[e._v("812321371")]),e._v(" 微信交流群: "),r("code",[e._v("MercyYao")])])]),e._v(" "),r("blockquote",[r("p",[e._v("微信公众号:")])]),e._v(" "),r("p",[r("img",{attrs:{src:"https://purgeyao.github.io/img/about-my-mp-8cm.jpg",alt:"微信公众号二维码"}})])])}),[],!1,null,null,null);t.default=s.exports}}]);