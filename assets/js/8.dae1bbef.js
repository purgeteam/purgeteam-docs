(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{354:function(t,s,a){"use strict";a.r(s);var e=a(43),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"springcloud异常处理统一封装我来做-使用篇"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#springcloud异常处理统一封装我来做-使用篇"}},[t._v("#")]),t._v(" SpringCloud异常处理统一封装我来做-使用篇")]),t._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),a("p",[t._v("重复功能我来写。在 "),a("code",[t._v("SpringBoot")]),t._v(" 项目里都有全局异常处理以及返回包装等，返回前端是带上"),a("code",[t._v("succ")]),t._v("、"),a("code",[t._v("code")]),t._v("、"),a("code",[t._v("msg")]),t._v("、"),a("code",[t._v("data")]),t._v("等字段。单个项目情况下很好解决，当微服务模块多的情况下，很多情况开发都是复制原有代码进行构建另外一个项目的，导致这些功能升级需要修改多个服务，在这个基础上，我们封装了一个组件 "),a("code",[t._v("unified-dispose-spring-cloud-starter")]),t._v(" 里面包含了一些基础的异常处理以及返回包装功能。")]),t._v(" "),a("h2",{attrs:{id:"依赖添加启动功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#依赖添加启动功能"}},[t._v("#")]),t._v(" 依赖添加启动功能")]),t._v(" "),a("p",[t._v("添加依赖\n"),a("strong",[t._v("ps:")]),t._v(" 实际version版本请使用最新版\n"),a("strong",[t._v("最新版本:")]),t._v(" "),a("a",{attrs:{href:"https://search.maven.org/search?q=g:com.purgeteam.cloud%20AND%20a:unified-dispose-spring-cloud-starter",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://img.shields.io/maven-central/v/com.purgeteam.cloud/unified-dispose-spring-cloud-starter.svg?label=Maven%20Central",alt:"Maven Central"}}),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://search.maven.org/search?q=g:com.purgeteam.cloud%20AND%20a:unified-dispose-spring-cloud-starter",target:"_blank",rel:"noopener noreferrer"}},[t._v("点击查看最新新版本"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<dependency>\n  <groupId>com.purgeteam.cloud</groupId>\n  <artifactId>unified-dispose-spring-cloud-starter</artifactId>\n  <version>0.3.0.RELEASE</version>\n</dependency>\n")])])]),a("p",[t._v("启动类添加 "),a("code",[t._v("@EnableGlobalDispose")]),t._v(" 注解开启以下功能。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("@EnableGlobalDispose\n@SpringBootApplication\npublic class GlobalDisposeSpringBootApplication {\n\n  public static void main(String[] args) {\n    SpringApplication.run(GlobalDisposeSpringBootApplication.class, args);\n  }\n\n}\n")])])]),a("h2",{attrs:{id:"one-异常处理⚠️"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#one-异常处理⚠️"}},[t._v("#")]),t._v(" One 异常处理⚠️")]),t._v(" "),a("p",[t._v("在项目中经常出现系统异常的情况，比如"),a("code",[t._v("NullPointerException")]),t._v("等等。如果默认未处理的情况下，"),a("code",[t._v("springboot")]),t._v("会响应默认的错误提示，这样对用户体验不是友好，系统层面的错误，用户不能感知到，即使为"),a("code",[t._v("500")]),t._v("的错误，可以给用户提示一个类似"),a("code",[t._v("服务器开小差")]),t._v("的友好提示等。")]),t._v(" "),a("p",[t._v("模块里以及包含了一些基本的异常处理方式(及不需要做任何代码编写已经具有基本异常处理)，以及一些常见的异常code，用户只需要关心业务异常处理即可，直接通过 "),a("code",[t._v("throw new 异常")]),t._v(" 的方式抛出即可。")]),t._v(" "),a("h3",{attrs:{id:"异常处理包含类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异常处理包含类型"}},[t._v("#")]),t._v(" 异常处理包含类型")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 通用500异常\nException 类捕获 500 异常处理\n\n# Feign 异常\nFeignException 类捕获\nClientException 类捕获\n\n# 业务自定义\nBusinessException 类捕获 业务通用自定义异常\n\n# 参数校验异常\nHttpMessageNotReadableException 参数错误异常\nBindException 参数错误异常\n")])])]),a("h3",{attrs:{id:"程序主动抛出异常"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#程序主动抛出异常"}},[t._v("#")]),t._v(" 程序主动抛出异常")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('throw new BusinessException(BusinessErrorCode.BUSINESS_ERROR);\n// 或者\nthrow new BusinessException("CLOUD800","没有多余的库存");\n')])])]),a("p",[t._v("通常不建议直接抛出通用的BusinessException异常，应当在对应的模块里添加对应的领域的异常处理类以及对应的枚举错误类型。")]),t._v(" "),a("p",[t._v("如会员模块：\n创建"),a("code",[t._v("UserException")]),t._v("异常类、"),a("code",[t._v("UserErrorCode")]),t._v("枚举。")]),t._v(" "),a("p",[t._v("UserException:")]),t._v(" "),a("p",[t._v("继承 "),a("code",[t._v("BusinessException")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * {@link RuntimeException} user 业务异常\n *\n * @author purgeyao\n * @since 1.0\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Getter")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BusinessException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" isShowMsg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * 使用枚举传参\n   *\n   * @param errorCode 异常枚举\n   */")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserErrorCode")]),t._v(" errorCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("errorCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" errorCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" errorCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("UserErrorCode:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Getter")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("enum")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserErrorCode")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 权限异常\n     */")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NOT_PERMISSIONS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CLOUD401"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"您没有操作权限"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserErrorCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("最后业务使用如下：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断是否有权限抛出异常")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserErrorCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NOT_PERMISSIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("上述方式，抛出异常后会被模块处理。前台返回如下")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{\n  "succ": false,        // 是否成功\n  "ts": 1566467628851,  // 时间戳\n  "data": null,         // 数据\n  "code": "CLOUD800",   // 错误类型\n  "msg": "业务异常",    // 错误描述\n}\n')])])]),a("h2",{attrs:{id:"tow-统一返回封装🗳"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tow-统一返回封装🗳"}},[t._v("#")]),t._v(" Tow 统一返回封装🗳")]),t._v(" "),a("p",[t._v("在REST风格的开发中，避免通常会告知前台返回是否成功以及状态码等信息。这里我们通常返回的时候做一次"),a("code",[t._v("util")]),t._v("的包装处理工作，如："),a("code",[t._v("Result")]),t._v("类似的类，里面包含"),a("code",[t._v("succ")]),t._v("、"),a("code",[t._v("code")]),t._v("、"),a("code",[t._v("msg")]),t._v("、"),a("code",[t._v("data")]),t._v("等字段。")]),t._v(" "),a("p",[t._v("接口调用处理类似如下:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('  @GetMapping("hello")\n  public Result list(){\n    return Result.ofSuccess("hello");\n  }\n')])])]),a("p",[t._v("结果:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{\n  "succ": ture,         // 是否成功\n  "ts": 1566467628851,  // 时间戳\n  "data": "hello",      // 数据\n  "code": null,         // 错误类型\n  "msg": null,          // 错误描述\n  "fail": true\n}\n')])])]),a("h3",{attrs:{id:"功能使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#功能使用"}},[t._v("#")]),t._v(" 功能使用")]),t._v(" "),a("p",[t._v("默认情况所有的 "),a("code",[t._v("web controller")]),t._v(" 都会被封装为以下返回格式。")]),t._v(" "),a("p",[t._v("接口：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("返回")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"succ"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 是否成功")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1566386951005")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 时间戳")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"data"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数据")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 错误类型")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"msg"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 错误描述")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"忽略封装注解-ignoreresponseadvice"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#忽略封装注解-ignoreresponseadvice"}},[t._v("#")]),t._v(" 忽略封装注解 "),a("code",[t._v("@IgnoreResponseAdvice")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("public @interface IgnoreResponseAdvice {\n\n    /**\n     * 是否进行全局异常处理封装\n     * @return true:进行处理;  false:不进行异常处理\n     */\n    boolean errorDispose() default true;\n\n}\n")])])]),a("p",[a("code",[t._v("@IgnoreResponseAdvice")]),t._v("允许范围为："),a("strong",[t._v("类 + 方法")]),t._v("，标识在类上这个类下的所有方法的返回都将忽略返回封装。")]),t._v(" "),a("p",[t._v("接口：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@IgnoreResponseAdvice")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 忽略数据包装 可添加到类、方法上")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("返回 "),a("code",[t._v("test")])]),t._v(" "),a("h3",{attrs:{id:"feignclient-调用异常返回处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#feignclient-调用异常返回处理"}},[t._v("#")]),t._v(" "),a("code",[t._v("FeignClient")]),t._v(" 调用异常返回处理")]),t._v(" "),a("p",[t._v("默认 "),a("code",[t._v("FeignClient")]),t._v(" 调用异常会返回 "),a("code",[t._v("FeignException")]),t._v(" 500 异常，由于开启了统一异常处理，被调用方feign异常会被处理为包装过后结果返回。")]),t._v(" "),a("p",[a("strong",[t._v("服务端：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('@Override\npublic Boolean testBoolean() throws Exception {\n    throw new Exception("模拟异常");\n}\n')])])]),a("p",[a("strong",[t._v("调用端：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('@GetMapping("testBoolean")\npublic Boolean testBoolean() throws Exception {\n    // 调用服务端异常\n    // 如果服务端不添加 @IgnoreResponseAdvice(errorDispose = false) 会出现下面异常\n    // There was an unexpected error (type=Internal Server Error, status=500).\n    // Error while extracting response for type [class java.lang.Boolean] and content type [application/json;charset=UTF-8]; nested exception is org.springframework.http.converter.HttpMessageNotReadableException: JSON parse error: Cannot deserialize instance of `java.lang.Boolean` out of START_OBJECT token; nested exception is com.fasterxml.jackson.databind.exc.MismatchedInputException: Cannot deserialize instance of `java.lang.Boolean` out of START_OBJECT token at [Source: (PushbackInputStream); line: 1, column: 1]\n    return exampleFeignClient.testBoolean();\n}\n')])])]),a("p",[t._v("因此 "),a("code",[t._v("exampleFeignClient#testBoolean")]),t._v(" 调用出现了 feign 转换异常了。")]),t._v(" "),a("p",[t._v("这里需要关闭提供者的 feign 接口异常处理。或者在此接口类上添加 "),a("code",[t._v("@IgnoreResponseAdvice(errorDispose = false)")]),t._v(" errorDispose 设置为 false")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('/**\n * 添加 IgnoreResponseAdvice#errorDispose 设置为异常不需要处理包装\n */\n@Override\n@IgnoreResponseAdvice(errorDispose = false)\npublic Boolean testBoolean() throws Exception {\n    throw new Exception("模拟异常");\n}\n')])])]),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("项目里很多重复的code，我们可以通过一定的方式去简化，以达到一定目的减少开发量。PurgeTeam 具有一些优秀的开源组件，减少日常的开发量。")]),t._v(" "),a("blockquote",[a("p",[t._v("示例代码地址:"),a("a",{attrs:{href:"https://github.com/purgeteam/spirng-cloud-purgeteam/tree/master/spring-cloud-purgeteam-examples/unified-dispose-spring-cloud-starter-examples",target:"_blank",rel:"noopener noreferrer"}},[t._v("unified-dispose-spring-cloud-starter"),a("OutboundLink")],1)])]),t._v(" "),a("blockquote",[a("p",[t._v("作者GitHub:\n"),a("a",{attrs:{href:"https://github.com/purgeyao",target:"_blank",rel:"noopener noreferrer"}},[t._v("Purgeyao"),a("OutboundLink")],1),t._v(" 欢迎关注")])]),t._v(" "),a("blockquote",[a("p",[t._v("qq交流群: "),a("code",[t._v("812321371")]),t._v(" 微信交流群: "),a("code",[t._v("MercyYao")])])]),t._v(" "),a("blockquote",[a("p",[t._v("微信公众号:")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://purgeyao.github.io/img/about-my-mp-8cm.jpg",alt:"微信公众号二维码"}})])])}),[],!1,null,null,null);s.default=n.exports}}]);